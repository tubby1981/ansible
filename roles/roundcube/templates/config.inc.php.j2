<?php

/*
 * Roundcube configuration file
 * Generated by Ansible - Do not edit manually!
 */

$config = [];

// Database connection
$config['db_dsnw'] = '{{ roundcube_database_type }}://{{ roundcube_database_user }}:{{ roundcube_database_password }}@{{ roundcube_database_host }}:{{ roundcube_database_port }}/{{ roundcube_database_name }}';

// IMAP Configuration
$config['default_host'] = '{{ roundcube_default_host }}';
$config['default_port'] = {{ roundcube_default_port }};
$config['imap_auth_type'] = null;
$config['imap_delimiter'] = null;
$config['imap_conn_options'] = [
    'ssl' => [
        'verify_peer' => true,
        'verify_peer_name' => true,
    ],
];

// SMTP Configuration
$config['smtp_server'] = '{{ roundcube_smtp_server }}';
$config['smtp_port'] = {{ roundcube_smtp_port }};
$config['smtp_user'] = '{{ roundcube_smtp_user }}';
$config['smtp_pass'] = '{{ roundcube_smtp_pass }}';
$config['smtp_auth_type'] = '';
$config['smtp_conn_options'] = [
    'ssl' => [
        'verify_peer' => true,
        'verify_peer_name' => true,
    ],
];

// Display name and support URL
$config['product_name'] = '{{ roundcube_product_name }}';
$config['support_url'] = '{{ roundcube_support_url }}';

// Security
$config['des_key'] = '{{ roundcube_des_key }}';
$config['cipher_method'] = 'AES-256-CBC';
$config['enable_installer'] = {{ roundcube_enable_installer | lower }};

// Session configuration
$config['session_lifetime'] = {{ roundcube_session_lifetime }};
$config['session_domain'] = '{{ roundcube_session_domain }}';
$config['session_path'] = '{{ roundcube_session_path }}';
$config['session_samesite'] = 'Lax';

// User interface
$config['skin'] = '{{ roundcube_skin }}';
$config['language'] = '{{ roundcube_language }}';
$config['timezone'] = '{{ roundcube_timezone }}';

// Plugins
$config['plugins'] = [
{% for plugin in roundcube_plugins %}
    '{{ plugin }}',
{% endfor %}
];

// Logging
$config['log_driver'] = '{{ roundcube_log_driver }}';
$config['log_dir'] = '{{ roundcube_log_dir }}';
$config['debug_level'] = {{ roundcube_debug_level }};

// Upload settings
$config['max_message_size'] = '{{ roundcube_upload_max_filesize }}';

// Password settings
$config['password_charset'] = '{{ roundcube_password_charset }}';
$config['password_minimum_length'] = {{ roundcube_password_minimum_length }};
$config['password_require_digit'] = {{ roundcube_password_require_digit | lower }};
$config['password_require_special'] = {{ roundcube_password_require_special | lower }};

// Prefer HTML over plain text
$config['prefer_html'] = true;
$config['htmleditor'] = 1;

// Message composition
$config['draft_autosave'] = 60;
$config['compose_responses_static'] = false;

// Security headers
$config['x_frame_options'] = 'sameorigin';

// Performance
$config['enable_caching'] = true;
$config['messages_cache'] = 'db';
$config['imap_cache'] = 'db';

// Managesieve (Sieve filters)
{% if roundcube_managesieve_enabled %}
$config['managesieve_host'] = '{{ roundcube_managesieve_host }}';
$config['managesieve_port'] = {{ roundcube_managesieve_port }};
$config['managesieve_usetls'] = {{ roundcube_managesieve_usetls | lower }};
{% endif %}

// Password plugin configuration
{% if roundcube_password_enabled %}
$config['password_driver'] = '{{ roundcube_password_driver }}';
$config['password_db_dsn'] = '{{ roundcube_password_db_dsn }}';
$config['password_query'] = '{{ roundcube_password_query }}';
$config['password_crypt_hash'] = '{{ roundcube_password_crypt_hash }}';
$config['password_algorithm'] = 'bcrypt';
$config['password_cost'] = 12;
{% endif %}

// Enigma (PGP) plugin configuration
{% if roundcube_enigma_enabled %}
$config['enigma_pgp_homedir'] = '{{ roundcube_enigma_pgp_homedir }}';
{% endif %}

// Other useful settings
$config['auto_create_user'] = true;
$config['login_autocomplete'] = 2;
$config['mail_domain'] = '';
$config['username_domain'] = '';

// Prevent clickjacking
$config['x_frame_options'] = 'sameorigin';

return $config;
