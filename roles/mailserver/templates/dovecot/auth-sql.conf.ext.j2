# Authentication for SQL users
# Generated by Ansible

{% if mailserver_dovecot_sql_v2 %}

# Dovecot >= 2.4

sql_driver = mysql

mysql localhost {
  dbname = {{ mailserver_db_name }}
  user = {{ mailserver_db_user }}
  password = {{ mailserver_db_password }}
}

passdb sql {
  default_password_scheme = ARGON2I
  query = SELECT username AS user, password FROM mailbox WHERE username = '%{user}' AND active = 1
}

userdb static {
  fields {
    home = {{ mailserver_storage_path }}/%{user|domain}/%{user|username}
    uid = vmail
    gid = vmail
  }
}

{% else %}
# Dovecot < 2.4 SQL auth (legacy syntax)

passdb {
  driver = sql
  args = /etc/dovecot/dovecot-sql.conf.ext
}

userdb {
  driver = sql
  args = /etc/dovecot/dovecot-sql.conf.ext
}
{% endif %}
