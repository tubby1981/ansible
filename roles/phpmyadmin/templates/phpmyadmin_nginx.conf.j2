# phpMyAdmin Nginx configuration snippet
# Generated by Ansible

location /{{ phpmyadmin_url_path }} {
    alias {{ phpmyadmin_web_root }};
    index index.php;

{% if phpmyadmin_restrict_access and phpmyadmin_allowed_hosts | length > 0 %}
    # Access restriction
{% for host in phpmyadmin_allowed_hosts %}
    allow {{ host }};
{% endfor %}
    deny all;
{% endif %}

    location ~ ^/{{ phpmyadmin_url_path }}/(.+\.php)$ {
        alias {{ phpmyadmin_web_root }}/$1;
        fastcgi_pass unix:/var/run/php/php-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $request_filename;
    }

    location ~* ^/{{ phpmyadmin_url_path }}/(.+\.(jpg|jpeg|gif|css|png|js|ico|html|xml|txt))$ {
        alias {{ phpmyadmin_web_root }}/$1;
    }
}

# Deny access to sensitive directories
location ~ ^/{{ phpmyadmin_url_path }}/(templates|libraries|setup/lib) {
    deny all;
}
