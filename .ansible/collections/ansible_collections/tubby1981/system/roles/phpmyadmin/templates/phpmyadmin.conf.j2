# phpMyAdmin Apache configuration
# Generated by Ansible

Alias /{{ phpmyadmin_url_path }} {{ phpmyadmin_web_root }}

<Directory {{ phpmyadmin_web_root }}>
    Options FollowSymLinks
    DirectoryIndex index.php

    <IfModule mod_authz_core.c>
        # Apache 2.4+
        <RequireAny>
{% if phpmyadmin_restrict_access and phpmyadmin_allowed_hosts | length > 0 %}
{% for host in phpmyadmin_allowed_hosts %}
            Require ip {{ host }}
{% endfor %}
{% else %}
            Require all granted
{% endif %}
        </RequireAny>
    </IfModule>

    <IfModule !mod_authz_core.c>
        # Apache 2.2
{% if phpmyadmin_restrict_access and phpmyadmin_allowed_hosts | length > 0 %}
        Order Deny,Allow
        Deny from All
{% for host in phpmyadmin_allowed_hosts %}
        Allow from {{ host }}
{% endfor %}
{% else %}
        Order Allow,Deny
        Allow from All
{% endif %}
    </IfModule>
</Directory>

# Disallow web access to directories that don't need it
<Directory {{ phpmyadmin_web_root }}/templates>
    Require all denied
</Directory>
<Directory {{ phpmyadmin_web_root }}/libraries>
    Require all denied
</Directory>
<Directory {{ phpmyadmin_web_root }}/setup/lib>
    Require all denied
</Directory>
